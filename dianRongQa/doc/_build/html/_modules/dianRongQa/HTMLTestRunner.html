<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dianRongQa.HTMLTestRunner &#8212; dianRongQa 1.5.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="dianRongQa 1.5.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for dianRongQa.HTMLTestRunner</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A TestRunner for use with the Python unit testing framework. It</span>
<span class="sd">generates a HTML report to show the result at a glance.</span>

<span class="sd">The simplest way to use this is to invoke its main method. E.g.</span>

<span class="sd">    import unittest</span>
<span class="sd">    import HTMLTestRunner</span>

<span class="sd">    ... define your tests ...</span>

<span class="sd">    if __name__ == &#39;__main__&#39;:</span>
<span class="sd">        HTMLTestRunner.main()</span>


<span class="sd">For more customization options, instantiates a HTMLTestRunner object.</span>
<span class="sd">HTMLTestRunner is a counterpart to unittest&#39;s TextTestRunner. E.g.</span>

<span class="sd">    # output to a file</span>
<span class="sd">    fp = file(&#39;my_report.html&#39;, &#39;wb&#39;)</span>
<span class="sd">    runner = HTMLTestRunner.HTMLTestRunner(</span>
<span class="sd">                stream=fp,</span>
<span class="sd">                title=&#39;My unit test&#39;,</span>
<span class="sd">                description=&#39;This demonstrates the report output by HTMLTestRunner.&#39;</span>
<span class="sd">                )</span>

<span class="sd">    # Use an external stylesheet.</span>
<span class="sd">    # See the Template_mixin class for more customizable options</span>
<span class="sd">    runner.STYLESHEET_TMPL = &#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;my_stylesheet.css&quot; type=&quot;text/css&quot;&gt;&#39;</span>

<span class="sd">    # run the test</span>
<span class="sd">    runner.run(my_test_suite)</span>


<span class="sd">------------------------------------------------------------------------</span>
<span class="sd">Copyright (c) 2004-2007, Wai Yip Tung</span>
<span class="sd">All rights reserved.</span>

<span class="sd">Redistribution and use in source and binary forms, with or without</span>
<span class="sd">modification, are permitted provided that the following conditions are</span>
<span class="sd">met:</span>

<span class="sd">* Redistributions of source code must retain the above copyright notice,</span>
<span class="sd">  this list of conditions and the following disclaimer.</span>
<span class="sd">* Redistributions in binary form must reproduce the above copyright</span>
<span class="sd">  notice, this list of conditions and the following disclaimer in the</span>
<span class="sd">  documentation and/or other materials provided with the distribution.</span>
<span class="sd">* Neither the name Wai Yip Tung nor the names of its contributors may be</span>
<span class="sd">  used to endorse or promote products derived from this software without</span>
<span class="sd">  specific prior written permission.</span>

<span class="sd">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span>
<span class="sd">IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED</span>
<span class="sd">TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span>
<span class="sd">PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER</span>
<span class="sd">OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<span class="sd">EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<span class="sd">PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<span class="sd">PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="sd">LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="sd">NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="sd">SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># URL: http://tungwaiyip.info/software/HTMLTestRunner.html</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Wai Yip Tung&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.8.2&quot;</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Change History</span>

<span class="sd">Version 0.8.2</span>
<span class="sd">* Show output inline instead of popup window (Viorel Lupu).</span>

<span class="sd">Version in 0.8.1</span>
<span class="sd">* Validated XHTML (Wolfgang Borgert).</span>
<span class="sd">* Added description of test classes and test cases.</span>

<span class="sd">Version in 0.8.0</span>
<span class="sd">* Define Template_mixin class for customization.</span>
<span class="sd">* Workaround a IE 6 bug that it does not treat &lt;script&gt; block as CDATA.</span>

<span class="sd">Version in 0.7.1</span>
<span class="sd">* Back port to Python 2.3 (Frank Horowitz).</span>
<span class="sd">* Fix missing scroll bars in detail log (Podi).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># TODO: color stderr</span>
<span class="c1"># TODO: simplify javascript using ,ore than 1 class in the class attribute?</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="c1">#import StringIO</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">xml.sax</span> <span class="k">import</span> <span class="n">saxutils</span>


<span class="c1"># ------------------------------------------------------------------------</span>
<span class="c1"># The redirectors below are used to capture output during testing. Output</span>
<span class="c1"># sent to sys.stdout and sys.stderr are automatically captured. However</span>
<span class="c1"># in some cases sys.stdout is already cached before HTMLTestRunner is</span>
<span class="c1"># invoked (e.g. calling logging.basicConfig). In order to capture those</span>
<span class="c1"># output, use the redirectors for the cached stream.</span>
<span class="c1">#</span>
<span class="c1"># e.g.</span>
<span class="c1">#   &gt;&gt;&gt; logging.basicConfig(stream=HTMLTestRunner.stdout_redirector)</span>
<span class="c1">#   &gt;&gt;&gt;</span>

<div class="viewcode-block" id="OutputRedirector"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.OutputRedirector">[docs]</a><span class="k">class</span> <span class="nc">OutputRedirector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Wrapper to redirect stdout or stderr &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span>

<div class="viewcode-block" id="OutputRedirector.write"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.OutputRedirector.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="OutputRedirector.writelines"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.OutputRedirector.writelines">[docs]</a>    <span class="k">def</span> <span class="nf">writelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="OutputRedirector.flush"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.OutputRedirector.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div></div>

<span class="n">stdout_redirector</span> <span class="o">=</span> <span class="n">OutputRedirector</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">stderr_redirector</span> <span class="o">=</span> <span class="n">OutputRedirector</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>



<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># Template</span>

<div class="viewcode-block" id="Template_mixin"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.Template_mixin">[docs]</a><span class="k">class</span> <span class="nc">Template_mixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define a HTML template for report customerization and generation.</span>

<span class="sd">    Overall structure of an HTML report</span>

<span class="sd">    HTML</span>
<span class="sd">    +------------------------+</span>
<span class="sd">    |&lt;html&gt;                  |</span>
<span class="sd">    |  &lt;head&gt;                |</span>
<span class="sd">    |                        |</span>
<span class="sd">    |   STYLESHEET           |</span>
<span class="sd">    |   +----------------+   |</span>
<span class="sd">    |   |                |   |</span>
<span class="sd">    |   +----------------+   |</span>
<span class="sd">    |                        |</span>
<span class="sd">    |  &lt;/head&gt;               |</span>
<span class="sd">    |                        |</span>
<span class="sd">    |  &lt;body&gt;                |</span>
<span class="sd">    |                        |</span>
<span class="sd">    |   HEADING              |</span>
<span class="sd">    |   +----------------+   |</span>
<span class="sd">    |   |                |   |</span>
<span class="sd">    |   +----------------+   |</span>
<span class="sd">    |                        |</span>
<span class="sd">    |   REPORT               |</span>
<span class="sd">    |   +----------------+   |</span>
<span class="sd">    |   |                |   |</span>
<span class="sd">    |   +----------------+   |</span>
<span class="sd">    |                        |</span>
<span class="sd">    |   ENDING               |</span>
<span class="sd">    |   +----------------+   |</span>
<span class="sd">    |   |                |   |</span>
<span class="sd">    |   +----------------+   |</span>
<span class="sd">    |                        |</span>
<span class="sd">    |  &lt;/body&gt;               |</span>
<span class="sd">    |&lt;/html&gt;                 |</span>
<span class="sd">    +------------------------+</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">STATUS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;pass&#39;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;fail&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">DEFAULT_TITLE</span> <span class="o">=</span> <span class="s1">&#39;Unit Test Report&#39;</span>
    <span class="n">DEFAULT_DESCRIPTION</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># ------------------------------------------------------------------------</span>
    <span class="c1"># HTML Template</span>

    <span class="n">HTML_TMPL</span> <span class="o">=</span> <span class="s2">r&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="s2">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;</span>
<span class="s2">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span>
<span class="s2">&lt;head&gt;</span>
<span class="s2">    &lt;title&gt;</span><span class="si">%(title)s</span><span class="s2">&lt;/title&gt;</span>
<span class="s2">    &lt;meta name=&quot;generator&quot; content=&quot;</span><span class="si">%(generator)s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;/&gt;</span>
<span class="s2">    </span><span class="si">%(stylesheet)s</span><span class="s2"></span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;&lt;!--</span>
<span class="s2">output_list = Array();</span>

<span class="s2">/* level - 0:Summary; 1:Failed; 2:All */</span>
<span class="s2">function showCase(level) {</span>
<span class="s2">    trs = document.getElementsByTagName(&quot;tr&quot;);</span>
<span class="s2">    for (var i = 0; i &lt; trs.length; i++) {</span>
<span class="s2">        tr = trs[i];</span>
<span class="s2">        id = tr.id;</span>
<span class="s2">        if (id.substr(0,2) == &#39;ft&#39;) {</span>
<span class="s2">            if (level &lt; 1) {</span>
<span class="s2">                tr.className = &#39;hiddenRow&#39;;</span>
<span class="s2">            }</span>
<span class="s2">            else {</span>
<span class="s2">                tr.className = &#39;&#39;;</span>
<span class="s2">            }</span>
<span class="s2">        }</span>
<span class="s2">        if (id.substr(0,2) == &#39;pt&#39;) {</span>
<span class="s2">            if (level &gt; 1) {</span>
<span class="s2">                tr.className = &#39;&#39;;</span>
<span class="s2">            }</span>
<span class="s2">            else {</span>
<span class="s2">                tr.className = &#39;hiddenRow&#39;;</span>
<span class="s2">            }</span>
<span class="s2">        }</span>
<span class="s2">    }</span>
<span class="s2">}</span>


<span class="s2">function showClassDetail(cid, count) {</span>
<span class="s2">    var id_list = Array(count);</span>
<span class="s2">    var toHide = 1;</span>
<span class="s2">    for (var i = 0; i &lt; count; i++) {</span>
<span class="s2">        tid0 = &#39;t&#39; + cid.substr(1) + &#39;.&#39; + (i+1);</span>
<span class="s2">        tid = &#39;f&#39; + tid0;</span>
<span class="s2">        tr = document.getElementById(tid);</span>
<span class="s2">        if (!tr) {</span>
<span class="s2">            tid = &#39;p&#39; + tid0;</span>
<span class="s2">            tr = document.getElementById(tid);</span>
<span class="s2">        }</span>
<span class="s2">        id_list[i] = tid;</span>
<span class="s2">        if (tr.className) {</span>
<span class="s2">            toHide = 0;</span>
<span class="s2">        }</span>
<span class="s2">    }</span>
<span class="s2">    for (var i = 0; i &lt; count; i++) {</span>
<span class="s2">        tid = id_list[i];</span>
<span class="s2">        if (toHide) {</span>
<span class="s2">            document.getElementById(&#39;div_&#39;+tid).style.display = &#39;none&#39;</span>
<span class="s2">            document.getElementById(tid).className = &#39;hiddenRow&#39;;</span>
<span class="s2">        }</span>
<span class="s2">        else {</span>
<span class="s2">            document.getElementById(tid).className = &#39;&#39;;</span>
<span class="s2">        }</span>
<span class="s2">    }</span>
<span class="s2">}</span>


<span class="s2">function showTestDetail(div_id){</span>
<span class="s2">    var details_div = document.getElementById(div_id)</span>
<span class="s2">    var displayState = details_div.style.display</span>
<span class="s2">    // alert(displayState)</span>
<span class="s2">    if (displayState != &#39;block&#39; ) {</span>
<span class="s2">        displayState = &#39;block&#39;</span>
<span class="s2">        details_div.style.display = &#39;block&#39;</span>
<span class="s2">    }</span>
<span class="s2">    else {</span>
<span class="s2">        details_div.style.display = &#39;none&#39;</span>
<span class="s2">    }</span>
<span class="s2">}</span>


<span class="s2">function html_escape(s) {</span>
<span class="s2">    s = s.replace(/&amp;/g,&#39;&amp;amp;&#39;);</span>
<span class="s2">    s = s.replace(/&lt;/g,&#39;&amp;lt;&#39;);</span>
<span class="s2">    s = s.replace(/&gt;/g,&#39;&amp;gt;&#39;);</span>
<span class="s2">    return s;</span>
<span class="s2">}</span>

<span class="s2">/* obsoleted by detail in &lt;div&gt;</span>
<span class="s2">function showOutput(id, name) {</span>
<span class="s2">    var w = window.open(&quot;&quot;, //url</span>
<span class="s2">                    name,</span>
<span class="s2">                    &quot;resizable,scrollbars,status,width=800,height=450&quot;);</span>
<span class="s2">    d = w.document;</span>
<span class="s2">    d.write(&quot;&lt;pre&gt;&quot;);</span>
<span class="s2">    d.write(html_escape(output_list[id]));</span>
<span class="s2">    d.write(&quot;\n&quot;);</span>
<span class="s2">    d.write(&quot;&lt;a href=&#39;javascript:window.close()&#39;&gt;close&lt;/a&gt;\n&quot;);</span>
<span class="s2">    d.write(&quot;&lt;/pre&gt;\n&quot;);</span>
<span class="s2">    d.close();</span>
<span class="s2">}</span>
<span class="s2">*/</span>
<span class="s2">--&gt;&lt;/script&gt;</span>

<span class="si">%(heading)s</span><span class="s2"></span>
<span class="si">%(report)s</span><span class="s2"></span>
<span class="si">%(ending)s</span><span class="s2"></span>

<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="c1"># variables: (title, generator, stylesheet, heading, report, ending)</span>


    <span class="c1"># ------------------------------------------------------------------------</span>
    <span class="c1"># Stylesheet</span>
    <span class="c1">#</span>
    <span class="c1"># alternatively use a &lt;link&gt; for external style sheet, e.g.</span>
    <span class="c1">#   &lt;link rel=&quot;stylesheet&quot; href=&quot;$url&quot; type=&quot;text/css&quot;&gt;</span>

    <span class="n">STYLESHEET_TMPL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;</span>
<span class="s2">body        { font-family: verdana, arial, helvetica, sans-serif; font-size: 80%; }</span>
<span class="s2">table       { font-size: 100%; }</span>
<span class="s2">pre         { }</span>

<span class="s2">/* -- heading ---------------------------------------------------------------------- */</span>
<span class="s2">h1 {</span>
<span class="s2">	font-size: 16pt;</span>
<span class="s2">	color: gray;</span>
<span class="s2">}</span>
<span class="s2">.heading {</span>
<span class="s2">    margin-top: 0ex;</span>
<span class="s2">    margin-bottom: 1ex;</span>
<span class="s2">}</span>

<span class="s2">.heading .attribute {</span>
<span class="s2">    margin-top: 1ex;</span>
<span class="s2">    margin-bottom: 0;</span>
<span class="s2">}</span>

<span class="s2">.heading .description {</span>
<span class="s2">    margin-top: 4ex;</span>
<span class="s2">    margin-bottom: 6ex;</span>
<span class="s2">}</span>

<span class="s2">/* -- css div popup ------------------------------------------------------------------------ */</span>
<span class="s2">a.popup_link {</span>
<span class="s2">}</span>

<span class="s2">a.popup_link:hover {</span>
<span class="s2">    color: red;</span>
<span class="s2">}</span>

<span class="s2">.popup_window {</span>
<span class="s2">    display: none;</span>
<span class="s2">    position: relative;</span>
<span class="s2">    left: 0px;</span>
<span class="s2">    top: 0px;</span>
<span class="s2">    /*border: solid #627173 1px; */</span>
<span class="s2">    padding: 10px;</span>
<span class="s2">    background-color: #E6E6D6;</span>
<span class="s2">    font-family: &quot;Lucida Console&quot;, &quot;Courier New&quot;, Courier, monospace;</span>
<span class="s2">    text-align: left;</span>
<span class="s2">    font-size: 8pt;</span>
<span class="s2">    width: 500px;</span>
<span class="s2">}</span>

<span class="s2">}</span>
<span class="s2">/* -- report ------------------------------------------------------------------------ */</span>
<span class="s2">#show_detail_line {</span>
<span class="s2">    margin-top: 3ex;</span>
<span class="s2">    margin-bottom: 1ex;</span>
<span class="s2">}</span>
<span class="s2">#result_table {</span>
<span class="s2">    width: 80%;</span>
<span class="s2">    border-collapse: collapse;</span>
<span class="s2">    border: 1px solid #777;</span>
<span class="s2">}</span>
<span class="s2">#header_row {</span>
<span class="s2">    font-weight: bold;</span>
<span class="s2">    color: white;</span>
<span class="s2">    background-color: #777;</span>
<span class="s2">}</span>
<span class="s2">#result_table td {</span>
<span class="s2">    border: 1px solid #777;</span>
<span class="s2">    padding: 2px;</span>
<span class="s2">}</span>
<span class="s2">#total_row  { font-weight: bold; }</span>
<span class="s2">.passClass  { background-color: #6c6; }</span>
<span class="s2">.failClass  { background-color: #c60; }</span>
<span class="s2">.errorClass { background-color: #c00; }</span>
<span class="s2">.passCase   { color: #6c6; }</span>
<span class="s2">.failCase   { color: #c60; font-weight: bold; }</span>
<span class="s2">.errorCase  { color: #c00; font-weight: bold; }</span>
<span class="s2">.hiddenRow  { display: none; }</span>
<span class="s2">.testcase   { margin-left: 2em; }</span>


<span class="s2">/* -- ending ---------------------------------------------------------------------- */</span>
<span class="s2">#ending {</span>
<span class="s2">}</span>

<span class="s2">&lt;/style&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>



    <span class="c1"># ------------------------------------------------------------------------</span>
    <span class="c1"># Heading</span>
    <span class="c1">#</span>

    <span class="n">HEADING_TMPL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;div class=&#39;heading&#39;&gt;</span>
<span class="s2">&lt;h1&gt;</span><span class="si">%(title)s</span><span class="s2">&lt;/h1&gt;</span>
<span class="si">%(parameters)s</span><span class="s2"></span>
<span class="s2">&lt;p class=&#39;description&#39;&gt;</span><span class="si">%(description)s</span><span class="s2">&lt;/p&gt;</span>
<span class="s2">&lt;/div&gt;</span>

<span class="s2">&quot;&quot;&quot;</span> <span class="c1"># variables: (title, parameters, description)</span>

    <span class="n">HEADING_ATTRIBUTE_TMPL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;p class=&#39;attribute&#39;&gt;&lt;strong&gt;</span><span class="si">%(name)s</span><span class="s2">:&lt;/strong&gt; </span><span class="si">%(value)s</span><span class="s2">&lt;/p&gt;</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="c1"># variables: (name, value)</span>



    <span class="c1"># ------------------------------------------------------------------------</span>
    <span class="c1"># Report</span>
    <span class="c1">#</span>

    <span class="n">REPORT_TMPL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;p id=&#39;show_detail_line&#39;&gt;Show</span>
<span class="s2">&lt;a href=&#39;javascript:showCase(0)&#39;&gt;Summary&lt;/a&gt;</span>
<span class="s2">&lt;a href=&#39;javascript:showCase(1)&#39;&gt;Failed&lt;/a&gt;</span>
<span class="s2">&lt;a href=&#39;javascript:showCase(2)&#39;&gt;All&lt;/a&gt;</span>
<span class="s2">&lt;/p&gt;</span>
<span class="s2">&lt;table id=&#39;result_table&#39;&gt;</span>
<span class="s2">&lt;colgroup&gt;</span>
<span class="s2">&lt;col align=&#39;left&#39; /&gt;</span>
<span class="s2">&lt;col align=&#39;right&#39; /&gt;</span>
<span class="s2">&lt;col align=&#39;right&#39; /&gt;</span>
<span class="s2">&lt;col align=&#39;right&#39; /&gt;</span>
<span class="s2">&lt;col align=&#39;right&#39; /&gt;</span>
<span class="s2">&lt;col align=&#39;right&#39; /&gt;</span>
<span class="s2">&lt;/colgroup&gt;</span>
<span class="s2">&lt;tr id=&#39;header_row&#39;&gt;</span>
<span class="s2">    &lt;td&gt;Test Group/Test case&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;Count&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;Pass&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;Fail&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;Error&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;View&lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="si">%(test_list)s</span><span class="s2"></span>
<span class="s2">&lt;tr id=&#39;total_row&#39;&gt;</span>
<span class="s2">    &lt;td&gt;Total&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(count)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(Pass)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(fail)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(error)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;&amp;nbsp;&lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="s2">&lt;/table&gt;</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="c1"># variables: (test_list, count, Pass, fail, error)</span>

    <span class="n">REPORT_CLASS_TMPL</span> <span class="o">=</span> <span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">&lt;tr class=&#39;</span><span class="si">%(style)s</span><span class="s2">&#39;&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(desc)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(count)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(Pass)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(fail)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;</span><span class="si">%(error)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">    &lt;td&gt;&lt;a href=&quot;javascript:showClassDetail(&#39;</span><span class="si">%(cid)s</span><span class="s2">&#39;,</span><span class="si">%(count)s</span><span class="s2">)&quot;&gt;Detail&lt;/a&gt;&lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="c1"># variables: (style, desc, count, Pass, fail, error, cid)</span>


    <span class="n">REPORT_TEST_WITH_OUTPUT_TMPL</span> <span class="o">=</span> <span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">&lt;tr id=&#39;</span><span class="si">%(tid)s</span><span class="s2">&#39; class=&#39;</span><span class="si">%(Class)s</span><span class="s2">&#39;&gt;</span>
<span class="s2">    &lt;td class=&#39;</span><span class="si">%(style)s</span><span class="s2">&#39;&gt;&lt;div class=&#39;testcase&#39;&gt;</span><span class="si">%(desc)s</span><span class="s2">&lt;/div&gt;&lt;/td&gt;</span>
<span class="s2">    &lt;td colspan=&#39;5&#39; align=&#39;center&#39;&gt;</span>

<span class="s2">    &lt;!--css div popup start--&gt;</span>
<span class="s2">    &lt;a class=&quot;popup_link&quot; onfocus=&#39;this.blur();&#39; href=&quot;javascript:showTestDetail(&#39;div_</span><span class="si">%(tid)s</span><span class="s2">&#39;)&quot; &gt;</span>
<span class="s2">        </span><span class="si">%(status)s</span><span class="s2">&lt;/a&gt;</span>

<span class="s2">    &lt;div id=&#39;div_</span><span class="si">%(tid)s</span><span class="s2">&#39; class=&quot;popup_window&quot;&gt;</span>
<span class="s2">        &lt;div style=&#39;text-align: right; color:red;cursor:pointer&#39;&gt;</span>
<span class="s2">        &lt;a onfocus=&#39;this.blur();&#39; onclick=&quot;document.getElementById(&#39;div_</span><span class="si">%(tid)s</span><span class="s2">&#39;).style.display = &#39;none&#39; &quot; &gt;</span>
<span class="s2">           [x]&lt;/a&gt;</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">        &lt;pre&gt;</span>
<span class="s2">        </span><span class="si">%(script)s</span><span class="s2"></span>
<span class="s2">        &lt;/pre&gt;</span>
<span class="s2">    &lt;/div&gt;</span>
<span class="s2">    &lt;!--css div popup end--&gt;</span>

<span class="s2">    &lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="c1"># variables: (tid, Class, style, desc, status)</span>


    <span class="n">REPORT_TEST_NO_OUTPUT_TMPL</span> <span class="o">=</span> <span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">&lt;tr id=&#39;</span><span class="si">%(tid)s</span><span class="s2">&#39; class=&#39;</span><span class="si">%(Class)s</span><span class="s2">&#39;&gt;</span>
<span class="s2">    &lt;td class=&#39;</span><span class="si">%(style)s</span><span class="s2">&#39;&gt;&lt;div class=&#39;testcase&#39;&gt;</span><span class="si">%(desc)s</span><span class="s2">&lt;/div&gt;&lt;/td&gt;</span>
<span class="s2">    &lt;td colspan=&#39;5&#39; align=&#39;center&#39;&gt;</span><span class="si">%(status)s</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="c1"># variables: (tid, Class, style, desc, status)</span>


    <span class="n">REPORT_TEST_OUTPUT_TMPL</span> <span class="o">=</span> <span class="s2">r&quot;&quot;&quot;</span>
<span class="si">%(id)s</span><span class="s2">: </span><span class="si">%(output)s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span> <span class="c1"># variables: (id, output)</span>



    <span class="c1"># ------------------------------------------------------------------------</span>
    <span class="c1"># ENDING</span>
    <span class="c1">#</span>

    <span class="n">ENDING_TMPL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;div id=&#39;ending&#39;&gt;&amp;nbsp;&lt;/div&gt;&quot;&quot;&quot;</span></div>

<span class="c1"># -------------------- The end of the Template class -------------------</span>


<span class="n">TestResult</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestResult</span>

<span class="k">class</span> <span class="nc">_TestResult</span><span class="p">(</span><span class="n">TestResult</span><span class="p">):</span>
    <span class="c1"># note: _TestResult is a pure representation of results.</span>
    <span class="c1"># It lacks the output and reporting ability compares to unittest._TextTestResult.</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">TestResult</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>

        <span class="c1"># result is a list of result in 4 tuple</span>
        <span class="c1"># (</span>
        <span class="c1">#   result code (0: success; 1: fail; 2: error),</span>
        <span class="c1">#   TestCase object,</span>
        <span class="c1">#   Test output (byte string),</span>
        <span class="c1">#   stack trace,</span>
        <span class="c1"># )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">def</span> <span class="nf">startTest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="n">TestResult</span><span class="o">.</span><span class="n">startTest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
        <span class="c1"># just one buffer for both stdout and stderr</span>
      <span class="c1">#  self.outputBuffer = StringIO.StringIO()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputBuffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">stdout_redirector</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputBuffer</span>
        <span class="n">stderr_redirector</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputBuffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout0</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr0</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout_redirector</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">stderr_redirector</span>


    <span class="k">def</span> <span class="nf">complete_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnect output redirection and return buffer.</span>
<span class="sd">        Safe to call multiple times.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout0</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout0</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stderr0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout0</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stderr0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputBuffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">stopTest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="c1"># Usually one of addSuccess, addError or addFailure would have been called.</span>
        <span class="c1"># But there are some path in unittest that would bypass this.</span>
        <span class="c1"># We must disconnect stdout in stopTest(), which is guaranteed to be called.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complete_output</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">addSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">TestResult</span><span class="o">.</span><span class="n">addSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete_output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ok &#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">TestResult</span><span class="o">.</span><span class="n">addError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_exc_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete_output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">_exc_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;E  &#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addFailure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">TestResult</span><span class="o">.</span><span class="n">addFailure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_exc_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">failures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complete_output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">_exc_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;F  &#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="HTMLTestRunner"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.HTMLTestRunner">[docs]</a><span class="k">class</span> <span class="nc">HTMLTestRunner</span><span class="p">(</span><span class="n">Template_mixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_TITLE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_DESCRIPTION</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>


<div class="viewcode-block" id="HTMLTestRunner.run"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.HTMLTestRunner.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="s2">&quot;Run the given test case or test suite.&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">_TestResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">test</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateReport</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="c1">#print &gt;&gt;sys.stderr, &#39;\nTime Elapsed: %s&#39; % (self.stopTime-self.startTime)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Time Elapsed: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stopTime</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">startTime</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="HTMLTestRunner.sortResult"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.HTMLTestRunner.sortResult">[docs]</a>    <span class="k">def</span> <span class="nf">sortResult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_list</span><span class="p">):</span>
        <span class="c1"># unittest does not seems to run in any particular order.</span>
        <span class="c1"># Here at least we want to group them together by class.</span>
        <span class="n">rmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="n">result_list</span><span class="p">:</span>
            <span class="n">cls</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">__class__</span>
            <span class="c1">#if not rmap.has_key(cls):</span>
            <span class="k">if</span>  <span class="ow">not</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">rmap</span><span class="p">:</span>  
                <span class="n">rmap</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
            <span class="n">rmap</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[(</span><span class="n">cls</span><span class="p">,</span> <span class="n">rmap</span><span class="p">[</span><span class="n">cls</span><span class="p">])</span> <span class="k">for</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="HTMLTestRunner.getReportAttributes"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.HTMLTestRunner.getReportAttributes">[docs]</a>    <span class="k">def</span> <span class="nf">getReportAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return report attributes as a list of (name, value).</span>
<span class="sd">        Override this to add custom attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">startTime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startTime</span><span class="p">)[:</span><span class="mi">19</span><span class="p">]</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stopTime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success_count</span><span class="p">:</span> <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Pass </span><span class="si">%s</span><span class="s1">&#39;</span>    <span class="o">%</span> <span class="n">result</span><span class="o">.</span><span class="n">success_count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">failure_count</span><span class="p">:</span> <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Failure </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">error_count</span><span class="p">:</span>   <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Error </span><span class="si">%s</span><span class="s1">&#39;</span>   <span class="o">%</span> <span class="n">result</span><span class="o">.</span><span class="n">error_count</span>  <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;Start Time&#39;</span><span class="p">,</span> <span class="n">startTime</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="HTMLTestRunner.generateReport"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.HTMLTestRunner.generateReport">[docs]</a>    <span class="k">def</span> <span class="nf">generateReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="n">report_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReportAttributes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">generator</span> <span class="o">=</span> <span class="s1">&#39;HTMLTestRunner </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">__version__</span>
        <span class="n">stylesheet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_stylesheet</span><span class="p">()</span>
        <span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_heading</span><span class="p">(</span><span class="n">report_attrs</span><span class="p">)</span>
        <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_report</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">ending</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_ending</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTML_TMPL</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">saxutils</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">),</span>
            <span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span><span class="p">,</span>
            <span class="n">stylesheet</span> <span class="o">=</span> <span class="n">stylesheet</span><span class="p">,</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="n">heading</span><span class="p">,</span>
            <span class="n">report</span> <span class="o">=</span> <span class="n">report</span><span class="p">,</span>
            <span class="n">ending</span> <span class="o">=</span> <span class="n">ending</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_generate_stylesheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">STYLESHEET_TMPL</span>


    <span class="k">def</span> <span class="nf">_generate_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_attrs</span><span class="p">):</span>
        <span class="n">a_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">report_attrs</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HEADING_ATTRIBUTE_TMPL</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">saxutils</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">saxutils</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="n">a_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HEADING_TMPL</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">saxutils</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">),</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a_lines</span><span class="p">),</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">saxutils</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">heading</span>


    <span class="k">def</span> <span class="nf">_generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sortedResult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sortResult</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cid</span><span class="p">,</span> <span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">cls_results</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sortedResult</span><span class="p">):</span>
            <span class="c1"># subtotal for a class</span>
            <span class="n">np</span> <span class="o">=</span> <span class="n">nf</span> <span class="o">=</span> <span class="n">ne</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="n">cls_results</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">np</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">nf</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">ne</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># format class description</span>
            <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">__module__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__doc__</span> <span class="ow">and</span> <span class="n">cls</span><span class="o">.</span><span class="n">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">doc</span> <span class="ow">and</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span>

            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORT_CLASS_TMPL</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">style</span> <span class="o">=</span> <span class="n">ne</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;errorClass&#39;</span> <span class="ow">or</span> <span class="n">nf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;failClass&#39;</span> <span class="ow">or</span> <span class="s1">&#39;passClass&#39;</span><span class="p">,</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span><span class="p">,</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">+</span><span class="n">nf</span><span class="o">+</span><span class="n">ne</span><span class="p">,</span>
                <span class="n">Pass</span> <span class="o">=</span> <span class="n">np</span><span class="p">,</span>
                <span class="n">fail</span> <span class="o">=</span> <span class="n">nf</span><span class="p">,</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">ne</span><span class="p">,</span>
                <span class="n">cid</span> <span class="o">=</span> <span class="s1">&#39;c</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cid</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cls_results</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_report_test</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORT_TMPL</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">test_list</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span>
            <span class="n">count</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success_count</span><span class="o">+</span><span class="n">result</span><span class="o">.</span><span class="n">failure_count</span><span class="o">+</span><span class="n">result</span><span class="o">.</span><span class="n">error_count</span><span class="p">),</span>
            <span class="n">Pass</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success_count</span><span class="p">),</span>
            <span class="n">fail</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">failure_count</span><span class="p">),</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">error_count</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">report</span>


    <span class="k">def</span> <span class="nf">_generate_report_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c1"># e.g. &#39;pt1.1&#39;, &#39;ft1.1&#39;, etc</span>
        <span class="n">has_output</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">o</span> <span class="ow">or</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">tid</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;p&#39;</span> <span class="ow">or</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;t</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">tid</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">shortDescription</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">doc</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">))</span> <span class="ow">or</span> <span class="n">name</span>
        <span class="n">tmpl</span> <span class="o">=</span> <span class="n">has_output</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORT_TEST_WITH_OUTPUT_TMPL</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORT_TEST_NO_OUTPUT_TMPL</span>

        <span class="c1"># o and e should be byte string because they are collected from stdout and stderr?</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="c1"># TODO: some problem with &#39;string_escape&#39;: it escape \n and mess up formating</span>
            <span class="c1"># uo = unicode(o.encode(&#39;string_escape&#39;))</span>
            <span class="c1">#uo = o.decode(&#39;latin-1&#39;)</span>
		<span class="c1">#	uo = o.decode(&#39;utf-8&#39;)</span>
                <span class="n">uo</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uo</span> <span class="o">=</span> <span class="n">o</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="c1"># TODO: some problem with &#39;string_escape&#39;: it escape \n and mess up formating</span>
            <span class="c1"># ue = unicode(e.encode(&#39;string_escape&#39;))</span>
            <span class="c1">#ue = e.decode(&#39;latin-1&#39;)</span>
			<span class="c1">#ue = e.decode(&#39;utf-8&#39;)</span>
            <span class="n">ue</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ue</span> <span class="o">=</span> <span class="n">e</span>

        <span class="n">script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORT_TEST_OUTPUT_TMPL</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">tid</span><span class="p">,</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">saxutils</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">uo</span><span class="o">+</span><span class="n">ue</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="n">tmpl</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">tid</span> <span class="o">=</span> <span class="n">tid</span><span class="p">,</span>
            <span class="n">Class</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;hiddenRow&#39;</span> <span class="ow">or</span> <span class="s1">&#39;none&#39;</span><span class="p">),</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s1">&#39;errorCase&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">&#39;failCase&#39;</span> <span class="ow">or</span> <span class="s1">&#39;none&#39;</span><span class="p">),</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span><span class="p">,</span>
            <span class="n">script</span> <span class="o">=</span> <span class="n">script</span><span class="p">,</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATUS</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_output</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_generate_ending</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENDING_TMPL</span></div>


<span class="c1">##############################################################################</span>
<span class="c1"># Facilities for running tests from the command line</span>
<span class="c1">##############################################################################</span>

<span class="c1"># Note: Reuse unittest.TestProgram to launch test. In the future we may</span>
<span class="c1"># build our own launcher to support more specific command line</span>
<span class="c1"># parameters like test title, CSS, etc.</span>
<div class="viewcode-block" id="TestProgram"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.TestProgram">[docs]</a><span class="k">class</span> <span class="nc">TestProgram</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestProgram</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A variation of the unittest.TestProgram. Please refer to the base</span>
<span class="sd">    class for command line parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TestProgram.runTests"><a class="viewcode-back" href="../../dianRongQa.html#dianRongQa.HTMLTestRunner.TestProgram.runTests">[docs]</a>    <span class="k">def</span> <span class="nf">runTests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Pick HTMLTestRunner as the default test runner.</span>
        <span class="c1"># base class&#39;s testRunner parameter is not useful because it means</span>
        <span class="c1"># we have to instantiate HTMLTestRunner before we know self.verbosity.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">testRunner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testRunner</span> <span class="o">=</span> <span class="n">HTMLTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">unittest</span><span class="o">.</span><span class="n">TestProgram</span><span class="o">.</span><span class="n">runTests</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>

<span class="n">main</span> <span class="o">=</span> <span class="n">TestProgram</span>

<span class="c1">##############################################################################</span>
<span class="c1"># Executing this module from the command line</span>
<span class="c1">##############################################################################</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, huangyong.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
    </div>

    

    
  </body>
</html>